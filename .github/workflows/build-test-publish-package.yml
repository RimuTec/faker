name: Build and Publish NuGet Package

on:
   push:
      branches:
         - master
      # paths:
      #    - "Directory.Build.props"

jobs:
   tests:
      uses: ./.github/workflows/build-and-test.yml

   build-test-publish:
      runs-on: ubuntu-latest
      needs: tests
      steps:
         - name: Checkout code
           uses: actions/checkout@v2
         
         - name: Setup .NET Core
           uses: actions/setup-dotnet@v1
           with:
              dotnet-version: 7.0.401
         
         - name: Restore NuGet packages
           run: dotnet restore
         
         - name: Build
           run: dotnet build --configuration Release --no-restore

         # - name: Test (this will run for several minutes)
         #   run: dotnet test  --configuration Release --no-restore --no-build --verbosity normal

         - name: Publish NuGet package
           run: dotnet nuget push Faker/bin/Release/RimuTec.Faker.*.nupkg --api-key ${{ secrets.NUGET_API_KEY }} --source https://api.nuget.org/v3/index.json
